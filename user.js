var xt=Object.create,Y=Object.defineProperty,Tt=Object.getPrototypeOf,yt=Object.prototype.hasOwnProperty,kt=Object.getOwnPropertyNames,Ot=Object.getOwnPropertyDescriptor;var Rt=t=>Y(t,"__esModule",{value:!0});var it=(t,e)=>()=>(e||(e={exports:{}},t(e.exports,e)),e.exports);var St=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of kt(e))!yt.call(t,s)&&s!=="default"&&Y(t,s,{get:()=>e[s],enumerable:!(r=Ot(e,s))||r.enumerable});return t},S=t=>St(Rt(Y(t!=null?xt(Tt(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var vt=it((C,gt)=>{C=gt.exports=Ht;C.getSerialize=wt;function Ht(t,e,r,s){return JSON.stringify(t,wt(e,s),r)}function wt(t,e){var r=[],s=[];return e==null&&(e=function(i,a){return r[0]===a?"[Circular ~]":"[Circular ~."+s.slice(0,r.indexOf(a)).join(".")+"]"}),function(i,a){if(r.length>0){var n=r.indexOf(this);~n?r.splice(n+1):r.push(this),~n?s.splice(n,Infinity,i):s.push(i),~r.indexOf(a)&&(a=e.call(this,i,a))}else r.push(a);return t==null?a:t.call(this,i,a)}}});var K=it((de,$t)=>{"use strict";var Lt=vt(),_t=function(){var t=4022871197,e=function(r){if(r){r=r.toString();for(var s=0;s<r.length;s++){t+=r.charCodeAt(s);var i=.02519603282416938*t;t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=i*4294967296}return(t>>>0)*23283064365386963e-26}else t=4022871197};return e},V=function(t){return function(){var e=48,r=1,s=e,i=new Array(e),a,n,u=0,$=new _t;for(a=0;a<e;a++)i[a]=$(Math.random());var T=function(){++s>=e&&(s=0);var o=1768863*i[s]+r*23283064365386963e-26;return i[s]=o-(r=o|0)},d=function(o){return Math.floor(o*(T()+(T()*2097152|0)*11102230246251565e-32))};d.string=function(o){var b,y="";for(b=0;b<o;b++)y+=String.fromCharCode(33+d(94));return y};var R=function(){var o=Array.prototype.slice.call(arguments);for(a=0;a<o.length;a++)for(n=0;n<e;n++)i[n]-=$(o[a]),i[n]<0&&(i[n]+=1)};return d.cleanString=function(o){return o=o.replace(/(^\s*)|(\s*$)/gi,""),o=o.replace(/[\x00-\x1F]/gi,""),o=o.replace(/\n /,`
`),o},d.hashString=function(o){for(o=d.cleanString(o),$(o),a=0;a<o.length;a++)for(u=o.charCodeAt(a),n=0;n<e;n++)i[n]-=$(u),i[n]<0&&(i[n]+=1)},d.seed=function(o){(typeof o=="undefined"||o===null)&&(o=Math.random()),typeof o!="string"&&(o=Lt(o,function(b,y){return typeof y=="function"?y.toString():y})),d.initState(),d.hashString(o)},d.addEntropy=function(){var o=[];for(a=0;a<arguments.length;a++)o.push(arguments[a]);R(u+++new Date().getTime()+o.join("")+Math.random())},d.initState=function(){for($(),a=0;a<e;a++)i[a]=$(" ");r=1,s=e},d.done=function(){$=null},typeof t!="undefined"&&d.seed(t),d.range=function(o){return d(o)},d.random=function(){return d(Number.MAX_VALUE-1)/Number.MAX_VALUE},d.floatBetween=function(o,b){return d.random()*(b-o)+o},d.intBetween=function(o,b){return Math.floor(d.random()*(b-o+1))+o},d}()};V.create=function(t){return new V(t)};$t.exports=V});var m=t=>`[${t}m`,U={bold:m("1"),black:m("30"),red:m("31"),green:m("32"),yellow:m("33"),blue:m("34"),magenta:m("35"),cyan:m("36"),white:m("37"),gray:m("90"),bgBlack:m("40"),bgRed:m("41"),bgGreen:m("42"),bgYellow:m("43"),bgBlue:m("44"),bgMagenta:m("45"),bgCyan:m("46"),bgWhite:m("47"),bgGray:m("100"),reset:m("0")};function jt(t){return t.endsWith(U.reset)?t:`${t}${U.reset}`}var c=Object.keys(U).reduce((t,e)=>({...t,[e]:r=>jt(`${U[e]}${r}`)}),{});var f;(function(t){t[t.Enter=13]="Enter",t[t.Esc=27]="Esc",t[t.Space=32]="Space",t[t.Backspace=127]="Backspace",t[t.K0=48]="K0",t[t.K1=49]="K1",t[t.K2=50]="K2",t[t.K3=51]="K3",t[t.K4=52]="K4",t[t.K5=53]="K5",t[t.K6=54]="K6",t[t.K7=55]="K7",t[t.K8=56]="K8",t[t.K9=57]="K9",t[t.A=97]="A",t[t.B=98]="B",t[t.C=99]="C",t[t.D=100]="D",t[t.E=101]="E",t[t.F=102]="F",t[t.G=103]="G",t[t.H=104]="H",t[t.I=105]="I",t[t.J=106]="J",t[t.K=107]="K",t[t.L=108]="L",t[t.M=109]="M",t[t.N=110]="N",t[t.O=111]="O",t[t.P=112]="P",t[t.Q=113]="Q",t[t.R=114]="R",t[t.S=115]="S",t[t.T=116]="T",t[t.U=117]="U",t[t.V=118]="V",t[t.W=119]="W",t[t.X=120]="X",t[t.Y=121]="Y",t[t.Z=122]="Z",t[t.Up=65]="Up",t[t.Down=66]="Down",t[t.Right=67]="Right",t[t.Left=68]="Left",t[t.Home=69]="Home",t[t.End=70]="End",t[t.PgUp=71]="PgUp",t[t.PgDown=72]="PgDown"})(f||(f={}));var nt="[A",It="[K",_=process.stdin;_.setRawMode(!0);_.setEncoding("utf8");async function ot(){return new Promise(t=>{_.once("data",e=>{switch(e){case"\r":t(13);break;case"":t(27);break;case"\x7F":t(127);break;case"[A":t(65);break;case"[B":t(66);break;case"[C":t(67);break;case"[D":t(68);break;case"[F":t(70);break;case"[H":t(69);break;case"[5~":t(71);break;case"[6~":t(72);break;case"":process.exit();default:e.match(/[ A-Za-z0-9]/)&&t(e.toLowerCase().charCodeAt(0))}})})}async function B(t,e,r=!0){let s=r?"\u2B05 e \u27A1":"\u2B07 e \u2B06",i=0,a=!1,n=c.blue("\xAB"),u=c.blue("\xBB");for(console.log(`
${t}`);!a;){let $=e.map((y,st)=>st!==i?` ${y} `:`${n}${y}${u}`).join(r?"":`
  `);console.log(`  ${$}`),console.log(c.gray(`   Use ${s} para escolher e \u21A9 para confirmar.`));let T=await ot();!r&&T===65||r&&T===68?i=i>0?i-1:e.length-1:!r&&T===66||r&&T===67?i=i<e.length-1?i+1:0:T===13&&(a=!0),H(r?2:1+e.length)}return H(2),_.removeAllListeners(),i}async function ct(t,e,r=!0){let s=r?"\u2B05 e \u27A1":"\u2B07 e \u2B06",i=[],a=0,n=!1,u=c.blue("\xAB"),$=c.blue("\xBB"),T=c.green("["),d=c.green("]");for(console.log(`
${t}`);!n;){let R=e.map((Q,at)=>i[at]?`${T}${Q}${d}`:at===a?`${u}${Q}${$}`:` ${Q} `).join(r?"":`
  `);console.log(`  ${R}`),console.log(c.gray(`   Use ${s} para escolher, 'espa\xE7o' para selecionar e \u21A9 para confirmar.`));let o=await ot();!r&&o===65||r&&o===68?a=a>0?a-1:e.length-1:!r&&o===66||r&&o===67?a=a<e.length-1?a+1:0:o===32?i[a]=!i[a]:o===13&&(n=!0),H(r?2:1+e.length)}return H(2),_.removeAllListeners(),i.reduce((R,o,b)=>i[b]?[...R,b]:R,[])}function H(t){console.log(`${nt}${It}`.repeat(t)+nt)}var Pt=S(require("fs"));var J=class{constructor(e=1){this.melds=[],this.playersHands=[new g],e==2&&this.playersHands.push(new g)}getHand(e=0){return this.playersHands[e]}};function lt(t,e,r){let s=Math.floor((t-e.length)/2)-1,i=r.repeat(s),a=t-s-e.length-2,n=r.repeat(a),u=c.white(`${i} ${e} ${n}`);console.log(c.bgBlue(u))}function D(t=""){let e=80;console.log();let r=c.white("=".repeat(e)),s=c.bgBlue(r);Array.isArray(t)?(console.log(s),t.forEach(i=>lt(e,i," ")),console.log(s)):t.length==0?console.log(s):lt(e,t,"="),console.log()}async function X(t){return new Promise(e=>setTimeout(e,t))}var ft=S(require("path")),z=S(require("child_process"));var Mt=S(require("child_process")),ht=S(require("stream")),ut=S(require("readline"));function Z(t){let e=(0,ut.createInterface)({input:t}),r=async function*(){for await(let s of e)yield s}();return async()=>(await r.next()).value}function dt(){let t=new ht.Readable({read:()=>{}});return process.on("message",e=>t.push(e)),{read:Z(t),write:e=>process.send(`${e}
`)}}var pt=S(require("path"));var O=console.log,Nt=3e3,mt=c.bgGreen(c.black("DEBUG:")),G=class{constructor(e,r){this.id=e;this.execName=r;pt.dirname(r)==="."?this.proc=(0,z.spawn)((0,ft.join)(process.cwd(),r)):this.proc=(0,z.spawn)(r),l.silent&&(O=()=>{}),this.proc.on("error",s=>{O(c.red(`Erro na execu\xE7\xE3o do programa ${r}.`)),O(c.red(s)),this.halt()}),this.proc.stderr.on("data",s=>{if(!l.silent){let i=s.toString().replace(/\n/g,`
	`);O(c.red(`Bot ${e}:`)),O(c.red(`	${i}`))}}),this._errorPromise=new Promise(s=>{this.proc.on("close",(i,a)=>{a!=="SIGINT"?(O(c.red(`Programa ${this.execName} terminou com signal ${a}.`)),s("EXEC_ERROR")):s("FINISHED")})}),this._read=Z(this.proc.stdout)}write(e){G.debug&&console.debug(`${mt} Enviando para ${this.id}: ${e}`),this.proc.stdin.write(`${e}
`)}async read(){let e,r=new Promise(n=>{e=setTimeout(()=>n("TIMEOUT"),3e3)}),s=this._read(),i=this._errorPromise,a=await Promise.race([r,s,i]).then(n=>n===void 0?"ERROR":n);return a==="TIMEOUT"?(O(`Jogador ${this.id} n\xE3o enviou dados no tempo de ${Nt}ms e foi eliminado.`),Promise.resolve("PLAYER_ERROR")):a==="ERROR"?(O(`Jogador ${this.id} teve problemas t\xE9cnicos e foi eliminado.`),Promise.resolve("PLAYER_ERROR")):(clearTimeout(e),G.debug&&console.debug(`${mt} Recebido de ${this.id}: ${a}`),Promise.resolve(a))}halt(){this.proc.kill("SIGINT")}},F=G;F.debug=!1;var p;(function(t){t.SETUP="Configura\xE7\xE3o inv\xE1lida.",t.ACTION="A\xE7\xE3o inv\xE1lida.",t.FORMAT="Formato de mensagem inv\xE1lido.",t.CARD="Carta inv\xE1lida.",t.DECK="Sequ\xEAncia de cartas inv\xE1lida.",t.MELD="Jogo inv\xE1lido.",t.FILE="Arquivo inv\xE1lido."})(p||(p={}));var h=console.log,W=c.bgGreen(c.black("DEBUG:")),l=class{constructor(e){this.players=e;if(e.length!==2&&e.length!==4&&this.fail(p.SETUP,"O jogo deve ter dois ou quatro jogadores."),l.silent&&(h=function(){}),l.seed?l.rand=K().create(l.seed):(l.seed=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),l.rand=K().create(l.seed)),h(`Seed da partida ${l.seed}`),this.discardPile=new g,this.stock=tt().merge(tt()),this.playersPerTeam=e.length/2,this.team0=new J(this.playersPerTeam),this.team1=new J(this.playersPerTeam),l.initFile)this.initFromFile(l.initFile);else{for(let r=0;r<11;r++)for(let s=0;s<this.playersPerTeam;s++)this.team0.getHand(s).push(this.stock.pop()),this.team1.getHand(s).push(this.stock.pop());this.discardPile.push(this.stock.pop()),this.playerIndex=Math.floor(l.random()*2*this.playersPerTeam)}}initFromFile(e){let r=(i,a)=>this.stock.remove(i)&&a.push(i),s=(i,a)=>{i.split(" ").slice(1,-1).map(n=>new w(n)).forEach(n=>r(n,a))};try{let a=(0,Pt.readFileSync)(e,"utf8").split(`
`).filter(n=>n.length>0);for(let n=0;n<this.playersPerTeam;n++)s(a[2*n+0],this.team0.getHand(n)),s(a[2*n+1],this.team1.getHand(n));r(new w(a[a.length-2]),this.discardPile),this.playerIndex=Number(a[a.length-1])}catch(i){console.error(i),this.closeGame()}}static random(){return this.rand.random()}initialSetup(){h(`O jogo come\xE7a com o jogador ${this.currentPlayerName}.`),h(`A pilha de descarte come\xE7a inicialmente com a carta ${this.discardPile.top}.`);let e=this.players.reduce((r,s)=>r+s.id+" ","").trimEnd();this.players.forEach((r,s)=>{this.send(e,r),this.send(r.id,r),this.send(this.getHand(s).str,r),this.send(this.discardPile.top.str,r)})}closeGame(){this.players.forEach(e=>e.halt()),process.exit()}countPoints(e){let r=0;return e.cards.forEach(s=>{s.value>=v.Three&&s.value<=v.Seven?r+=5:s.value==v.Two||s.value>=v.Eight&&s.value<=v.King?r+=10:r+=15}),e.length>=7&&(r+=e.cards.some((i,a,n)=>{if(i.value!==v.Two)return!1;if(a<0){let u=n[a-1];if(u.value!==v.Ace||u.suit!==i.suit)return!0}if(a<n.length-1){let u=n[a+1];if(u.value!==v.Three||u.suit!==i.suit)return!0}return!1})?100:200),r}countTeamPoints(e){let r=e.melds.reduce((a,n)=>a+this.countPoints(n),0),s=this.countPoints(e.playersHands[0]);s===0&&(s=-100);let i=0;return this.playersPerTeam==2&&(i=this.countPoints(e.playersHands[1]),i===0&&(i=-100)),r-s-i}showPoints(e,r,s,i){e.forEach((a,n)=>h(`${a} tinha na m\xE3o as cartas ${r[n].sorted()}`)),s.length>0?(h("Os seguintes jogos foram baixados:"),s.forEach(a=>h(a.toString()))):h("Nenhum jogo foi baixado."),h(`Total de pontos: ${i} pontos`)}gameOver(e){let r=this.countTeamPoints(this.team0),s=this.countTeamPoints(this.team1),i=this.players[0].color(this.players[0].id),a=this.players[1].color(this.players[1].id);if(l.silent)if(this.playersPerTeam===1)console.log(r===s?`OK ${l.seed} ${r} ${s} empate`:`OK ${l.seed} ${r} ${s} ${r>s?this.players[0].id:this.players[1].id}`);else{let n=r>s?`${this.players[0].id} e ${this.players[2].id}`:`${this.players[1].id} e ${this.players[3].id}`;console.log(r===s?`OK ${l.seed} ${r} ${s} empate`:`OK ${l.seed} ${r} ${s} ${n}`)}else if(D(e),this.playersPerTeam===1)this.showPoints([i],[this.getHand(0)],this.team0.melds,r),D(),this.showPoints([a],[this.getHand(1)],this.team1.melds,s),D(),h(r===s?"Incr\xEDvel! Houve um empate!":`${r>s?i:a} venceu.
`);else{let n=this.players[2].color(this.players[2].id),u=this.players[3].color(this.players[3].id);this.showPoints([i,n],[this.getHand(0),this.getHand(2)],this.team0.melds,r),D(),this.showPoints([a,u],[this.getHand(1),this.getHand(3)],this.team1.melds,s),D();let $=r>s?`${i} e ${n}`:`${a} e ${u}`;h(r===s?"Incr\xEDvel! Houve um empate!":`${$} venceram.
`)}this.closeGame()}async run(){for(;;)this.broadcast(this.currentPlayer.id),await this.firstMove(),await this.secondMove(),this.playerIndex=(this.playerIndex+1)%this.players.length}async firstMove(){let{action:e,args:r}=await this.receiveAction();e==="GET_STOCK"?this.getStock():e==="GET_DISCARD"?(this.getDiscard(r),this.currentHand.cards.length===0&&this.gameOver(`Jogador ${this.currentPlayer.id} bateu.`)):e=="PLAYER_ERROR"?this.fail(p.ACTION,`Algo estranho ocorreu com o jogador ${this.currentPlayer.id}`):this.fail(p.ACTION,`A primeira a\xE7\xE3o deve ser puxar uma carta do monte (GET_STOCK) ou do lixo (GET_DISCARD) e foi enviado ${c.yellow(e)}.`),this.showPlayerState()}async secondMove(){let e;do{switch(e=await this.receiveAction(),e.action){case"MELD_NEW":this.createMeld(e.args);break;case"MELD_JOIN":this.joinMeld(e.args);break;case"DISCARD":this.discard(e.args);break;case"PLAYER_ERROR":this.fail(p.ACTION,`Algo estranho ocorreu com o jogador ${this.currentPlayer.id}`);break;default:this.fail(p.ACTION,`Poss\xEDveis a\xE7\xF5es: MELD_NEW, MELD_JOIN ou DISCARD. A a\xE7\xE3o ${e.action} n\xE3o \xE9 poss\xEDvel.`);break}this.currentHand.cards.length===0&&this.gameOver(`Jogador ${this.currentPlayer.id} bateu.`),this.showPlayerState()}while(e.action!=="DISCARD")}showPlayerState(){F.debug&&(h(`${W} M\xE3o do jogador ${this.currentPlayerName}`),h(`${W} ${this.currentHand.sorted()}`),h(`${W} Jogos do jogador ${this.currentPlayerName}`),this.currentTeam.melds.forEach(e=>h(`${W} ${e}`)))}getStock(){let e=this.stock.pop();e?(this.currentHand.push(e),this.send(e.str),this.broadcastNonCurrent("GET_STOCK"),h(`${this.currentPlayerName} puxou uma carta do deque de compra.`)):this.gameOver("N\xE3o h\xE1 mais cartas para puxar. O jogo terminou.")}getDiscard(e){e.length<2&&this.fail(p.DECK,"\xC9 necess\xE1rio pelo menos duas cartas para se juntar com o topo do lixo.");let r;try{r=e.map(a=>new w(a))}catch(a){this.fail(p.CARD,a)}let s=this.discardPile.pop(),i=new g([s,...r]);this.currentHand.hasAll(r)===!1?this.fail(p.DECK,"Tentativa de forma jogo com cartas que n\xE3o est\xE3o na m\xE3o."):i.isMeld()?(this.currentTeam.melds.push(i),this.send(this.discardPile.str),this.broadcastNonCurrent(`GET_DISCARD [ ${e.join(" ")} ]`),this.currentHand.removeCards(r),this.currentHand.merge(this.discardPile),h(`${this.currentPlayerName} pegou o lixo e fez o jogo ${i}.`)):this.fail(p.MELD,`As cartas ${i} n\xE3o formam um jogo.`)}createMeld(e){let r;try{r=e.map(i=>new w(i))}catch(i){this.fail(p.CARD,i)}let s=new g(r);this.currentHand.hasAll(r)===!1?this.fail(p.DECK,"Tentativa de forma jogo com cartas que n\xE3o est\xE3o na m\xE3o."):s.isMeld()?(this.currentTeam.melds.push(s),this.currentHand.removeCards(r),this.broadcastNonCurrent(`MELD_NEW ${s.str}`),h(`${this.currentPlayerName} baixou o jogo ${s}.`)):this.fail(p.MELD,`As cartas ${s} n\xE3o formam um jogo.`)}joinMeld([e,...r]){let s=Number(e);(s<0||s>=this.currentTeam.melds.length)&&this.fail(p.FORMAT,`O identificador ${e} n\xE3o costa nos jogos da equipe.`),(r[0]!=="["||r[r.length-1]!=="]")&&this.fail(p.FORMAT,"As cartas a serem anexadas ao jogo devem estar entre [ ].");let i;try{i=r.slice(1,-1).map(n=>new w(n))}catch(n){this.fail(p.CARD,n)}let a=this.currentTeam.melds[s];if(a.pushCards(i),this.currentHand.hasAll(i)===!1)this.fail(p.DECK,"Tentativa de forma jogo com cartas que n\xE3o est\xE3o na m\xE3o.");else if(a.isMeld()){this.currentHand.removeCards(i);let n=new g(i);this.broadcastNonCurrent(`MELD_JOIN ${e} ${n.str}`),h(`${this.currentPlayerName} adicionou as cartas ${n.str} atualizando o jogo ${a}.`)}else this.fail(p.MELD,`As cartas ${a} n\xE3o formam um jogo.`)}discard(e){e.length===0&&this.fail(p.FORMAT,"\xC9 necess\xE1rio informar a carta a ser descartada na a\xE7\xE3o DISCARD"),e.length>1&&this.fail(p.FORMAT,"A\xE7\xE3o DISCARD requer um \xFAnico par\xE2metro, a carta a ser descartada");try{let r=new w(e[0]);this.currentHand.has(r)?(this.currentHand.remove(r),this.discardPile.push(r),this.broadcastNonCurrent(`DISCARD ${r.str}`),h(`${this.currentPlayerName} descartou a carta ${r}.`)):this.fail(p.CARD,`O jogador n\xE3o possui a carta ${r}.`)}catch(r){this.fail(p.CARD,r)}}async receive(){return await this.currentPlayer.read()}async receiveAction(){let e=await this.receive(),[r,...s]=e.split(" ").filter(i=>i.length>0);return s[0]==="["&&s[s.length-1]==="]"&&(s=s.slice(1,-1)),{action:r,args:s}}send(e,r=this.currentPlayer){return r.write(e)}broadcast(e,r=this.players){r.forEach(s=>this.send(e,s))}broadcastNonCurrent(e){this.broadcast(e,this.players.filter(r=>r!=this.currentPlayer))}disqualify(e){h(`${e.id}: ${c.red("DESQUALIFICADO")}`);let r=this.countTeamPoints(this.team0),s=this.countTeamPoints(this.team1),i=this.players[0].color(this.players[0].id),a=this.players[1].color(this.players[1].id);if(l.silent)if(this.playersPerTeam===1)console.log(`NOK ${l.seed} ${r} ${s} ${e!==this.players[0]?this.players[0].id:this.players[1].id}`);else{let n=e!==this.players[0]?`${this.players[0].id} e ${this.players[2].id}`:`${this.players[1].id} e ${this.players[3].id}`;console.log(`NOK ${l.seed} ${r} ${s} ${n}`)}else if(D(),this.playersPerTeam===1)this.showPoints([i],[this.getHand(0)],this.team0.melds,r),D(),this.showPoints([a],[this.getHand(1)],this.team1.melds,s),D(),h(`${e!==this.players[0]?i:a} venceu.
`);else{let n=this.players[2].color(this.players[2].id),u=this.players[3].color(this.players[3].id);this.showPoints([i,n],[this.getHand(0),this.getHand(2)],this.team0.melds,r),D(),this.showPoints([a,u],[this.getHand(1),this.getHand(3)],this.team1.melds,s),D();let $=e!==this.players[0]?`${i} e ${n}`:`${a} e ${u}`;h(`${$} venceram.
`)}}fail(e,r){h(`${this.currentPlayerName}: ${c.red(e)} ${r}`),this.disqualify(this.currentPlayer),this.closeGame()}getTeam(e){return e%2==0?this.team0:this.team1}get currentTeam(){return this.getTeam(this.playerIndex)}get oponentTeam(){return this.getTeam(this.playerIndex)===this.team0?this.team1:this.team0}get currentPlayerName(){return this.currentPlayer.color(this.currentPlayer.id)}get currentPlayer(){return this.players[this.playerIndex]}get currentHand(){return this.getHand(this.playerIndex)}getHand(e){return this.getTeam(e).getHand(e<2?0:1)}};var j="\u2665\u2666\u2663\u2660".split(""),bt;(function(t){t[t.Heart=0]="Heart",t[t.Diamonds=1]="Diamonds",t[t.Clubs=2]="Clubs",t[t.Spades=3]="Spades"})(bt||(bt={}));var q=["2","3","4","5","6","7","8","9","10","J","Q","K","A"],v;(function(t){t[t.Two=0]="Two",t[t.Three=1]="Three",t[t.Four=2]="Four",t[t.Five=3]="Five",t[t.Six=4]="Six",t[t.Seven=5]="Seven",t[t.Eight=6]="Eight",t[t.Nine=7]="Nine",t[t.Ten=8]="Ten",t[t.Jack=9]="Jack",t[t.Queen=10]="Queen",t[t.King=11]="King",t[t.Ace=12]="Ace"})(v||(v={}));var w=class{constructor(e,r){if(typeof e=="string"){let s=j.reduce((n,u)=>e.indexOf(u)>n?e.indexOf(u):n,-1);if(s<0||s>=j.length)throw new Error(`Carta ${e} \xE9 inv\xE1lida: n\xE3o h\xE1 naipe.`);let i=e.substring(0,s),a=e.substring(s);if(this._value=q.findIndex(n=>n===i),this._suit=j.findIndex(n=>n===a),this._value<0||this._value>=q.length)throw new Error(`Carta ${e} \xE9 inv\xE1lida: valor inexistente.`)}else{if(r===void 0)throw new Error("Carta sem naipe associado.");this._value=e,this._suit=r}}get value(){return this._value}get suit(){return this._suit}get str(){return q[this._value]+j[this._suit]}toString(){let e=c.black(q[this._value]),r=this._suit<2?c.red(j[this._suit]):c.black(j[this._suit]);return c.bgWhite(e)+c.bgWhite(r)}};function tt(){let t=new g;for(let e=0;e<j.length;e++)for(let r=0;r<q.length;r++)t.push(new w(r,e));return t.shuffle(),t.shuffle(),t}var g=class{constructor(e=[]){this.cards=e}get length(){return this.cards.length}shuffle(){for(let e=this.cards.length-1;e>0;e--){let r=Math.floor(l.random()*(e+1));[this.cards[e],this.cards[r]]=[this.cards[r],this.cards[e]]}}sort(){this.cards.sort((e,r)=>e.suit!=r.suit?e.suit-r.suit:e.value-r.value)}sorted(){let e=this.cards.slice();return e.sort((r,s)=>r.suit!=s.suit?r.suit-s.suit:r.value-s.value),e}get str(){return`[ ${this.cards.map(e=>e.str).join(" ")} ]`}toString(){return`[ ${this.cards.join(" ")} ]`}get top(){return this.cards[this.cards.length-1]}pop(){return this.cards.pop()}push(e){e!==void 0&&this.cards.push(e)}pushCards(e){e.forEach(r=>this.cards.push(r))}indexOf(e){return this.cards.findIndex(r=>r.value===e.value&&r.suit===e.suit)}has(e){return this.indexOf(e)>=0}hasAll(e){return e.every(r=>this.has(r))}remove(e){let r=this.indexOf(e);return r<0?!1:(this.cards.splice(r,1),!0)}removeCards(e){e.forEach(r=>this.remove(r))}clear(){this.cards=[]}merge(e){for(;e.length>0;)this.push(e.pop());return this.shuffle(),this}isMeld(){if(this.cards.length<3||this.cards.length>14)return!1;let e=[],r=[],s=[];this.cards.forEach(a=>{a.value===12?e.push(a):a.value===0?s.push(a):r.push(a)});let i=r.length>0?r[0].suit:e[0].suit;if(r.some(a=>a.suit!==i)||(r.sort((a,n)=>a.suit!=n.suit?a.suit-n.suit:a.value-n.value),s.length>2))return!1;if(s.length===2){if(s[0].suit!==i&&s[1].suit!==i)return!1;let a=s[0].suit===i?0:1;r.unshift(s.splice(a,1)[0])}if(e.length>2)return!1;e.length===2&&r.push(e.pop());for(let a=1;a<r.length;a++){let n=Math.abs(r[a].value-r[a-1].value);if(n===0||n>2)return!1;if(n===2){if(s.length===0)return!1;r.splice(a,0,s.pop()),a++}}if(e.length===1)if(r[0].value===0)r.unshift(e.pop());else if(r[r.length-1].value===11)r.push(e.pop());else if(s.length===1)if(r[0].value===1)r.unshift(s.pop()),r.unshift(e.pop());else if(r[r.length-1].value===10)r.push(s.pop()),r.push(e.pop());else return!1;else return!1;return s.length===1&&r.unshift(s.pop()),this.cards=r,!0}};var Bt=[c.cyan,c.yellow,c.magenta,c.cyan],I=console.log,E=dt(),Dt=class{constructor(e,r){this.id=e;this.color=r}toString(){return this.color(this.id)}},qt={},et,Et,P,A,k,M,N=0;async function At(){return(await E.read()).split(" ").slice(1,-1).filter(t=>t.length>0)}function x(t=null){D(et),N=3,t&&(I(t),N++),I(`Voc\xEA possui as cartas ${P}`),I(A?`O topo da pilha de descarte \xE9 ${A}`:"A pilha de descarte est\xE1 vazia."),N+=2,k.length>0&&(I("Sua equipe tem os seguintes jogos na mesa:"),k.forEach(e=>I(e.toString())),N+=1+k.length),M.length>0&&(I("Seu advers\xE1rio tem os seguintes jogos na mesa:"),M.forEach(e=>I(e.toString())),N+=1+M.length)}function L(){H(N),N=0}async function Ut(){Et=(await E.read()).split(" "),Et.forEach((t,e)=>qt[t]=new Dt(t,Bt[e])),et=await E.read(),P=new g((await At()).map(t=>new w(t))),P.sort(),A=new w(await E.read()),k=[],M=[]}async function Jt(){let t,e,r,s,i;for(;(t=await E.read())!==et;)do switch([e,...r]=(await E.read()).split(" "),e){case"GET_STOCK":break;case"GET_DISCARD":s=r.slice(1,-1).map(a=>new w(a)),s.push(A),i=new g(s),i.sort(),M.push(i),A=null;break;case"DISCARD":A=new w(r[0]);break;case"MELD_NEW":s=r.slice(1,-1).map(a=>new w(a)),i=new g(s),M.push(i);break;case"MELD_JOIN":s=r.slice(2,-1).map(a=>new w(a)),i=M[Number(r[0])],i.merge(new g(s));break;default:break}while(e!=="DISCARD")}async function Ft(){L(),E.write("GET_STOCK");let t=await E.read(),e=new w(t);return P.push(e),P.sort(),x(`Voc\xEA puxou a carta ${e}`),!0}async function rt(t){let e=P.cards.map(i=>i.toString()),r=await ct(t,e);return new g(r.map(i=>P.cards[i]))}async function Gt(){let t=await rt(`Com quais cartas voc\xEA far\xE1 jogo com ${A}?`);if(L(),t.length<2)return x(`Selecione pelo menos 2 cartas para formar um jogo com ${A}.`),!1;let e=new g([A,...t.cards]);if(e.isMeld()){E.write(`GET_DISCARD ${t.str}`);let s=(await At()).map(i=>new w(i));return P.removeCards(t.cards),P.pushCards(s),P.sort(),k.push(e),A=null,x(s.length>0?`O lixo tinha as seguintes cartas ${new g(s)}`:"N\xE3o tinha nenhuma carta na pilha de descarte al\xE9m da usada no jogo."),!0}else return x(`As cartas ${e} n\xE3o formam um jogo v\xE1lido.`),!1}async function Wt(){let t=P.cards.map(s=>s.toString()),e=await B("Escolha uma carta para descartar.",t),r=P.cards[e];L(),E.write(`DISCARD ${r.str}`),A=r,P.remove(r)}async function Qt(){let t=await rt("Quais cartas do jogo voc\xEA quer baixar?");L(),t.isMeld()?(E.write(`MELD_NEW ${t.str}`),await X(50),P.removeCards(t.cards),k.push(t),x("Jogo baixado")):x(`${t} n\xE3o forma um jogo v\xE1lido.`)}async function Yt(){if(k.length>0){let t=k.map(s=>s.toString()),e=await B("Em qual jogo voc\xEA baixar cartas?",t,!1),r=await rt(`Quais cartas ser\xE3o adicionadas no jogo ${t[e]}`);if(L(),r.length>0){let s=k[e];s.pushCards(r.cards),s.isMeld()?(E.write(`MELD_JOIN ${e} ${r.str}`),await X(50),P.removeCards(r.cards),x(`Cartas ${r} adicionadas no jogo ${s}.`)):(s.removeCards(r.cards),x(`A jun\xE7\xE3o de ${r} com ${s} n\xE3o forma um jogo v\xE1lido.`))}else x("Nenhuma carta selecionada. Pressione espa\xE7o para adicionar/remover uma carta durante a sele\xE7\xE3o.")}else L(),x("N\xE3o h\xE1 jogo para adicionar cartas")}async function Xt(){let t=!1;do switch(await B("\xC9 sua vez! Voc\xEA come\xE7a puxando uma carta. De onde voc\xEA quer puxar?",["Do deque de compra","Da pilha de descarte (fazendo um jogo com a carta do topo)"],!1)){case 0:t=await Ft();break;case 1:t=await Gt();break}while(!t)}async function Zt(){let t;do switch(t=await B("O que deseja fazer agora?",["Descartar uma carta (e finalizar a jogada)","Baixar um jogo na mesa","Adicionar cartas num jogo"],!1),t){case 0:await Wt();break;case 1:await Qt();break;case 2:await Yt();break}while(t!==0)}async function zt(){x(),await Xt(),await Zt()}async function Ct(){for(await Ut();;)await Jt(),await zt()}process.send?Ct():console.log(`
    Este script substitui um bot no Buraco, interagindo com o usu\xE1rio nas tomadas
    de decis\xE3o. Ele n\xE3o foi feito para ser executado de forma independente.
    `);
